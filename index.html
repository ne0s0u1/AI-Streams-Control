<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>AI Streams</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #1a1a2e, #16213e);
      color: #eee;
      padding: 20px;
      margin: 0;
    }

    h1 {
      text-align: center;
      color: #9d4edd;
    }

    .container {
      max-width: 1000px;
      margin: auto;
      background: #1f1f2e;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 25px rgba(157, 78, 221, 0.5);
    }

    .input-group {
      margin-bottom: 15px;
      display: flex;
      gap: 10px;
      align-items: center;
    }

    input, select {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 6px;
      background: #2a2a40;
      color: #eee;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      background: linear-gradient(135deg, #7209b7, #560bad);
      color: #fff;
      transition: 0.3s;
    }

    button:hover {
      background: linear-gradient(135deg, #9d4edd, #7b2cbf);
    }

    .table-container {
      margin-top: 20px;
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 10px;
      text-align: center;
      border-bottom: 1px solid #333;
    }

    th {
      background: #2a2a40;
    }

    tr:hover {
      background: #33334d;
    }

    .actions {
      margin-top: 15px;
      display: flex;
      justify-content: center;
      gap: 15px;
    }

    .pagination {
      margin-top: 15px;
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    .json-container {
      margin-top: 15px;
      display: none;
      white-space: pre-wrap;
      background: #222;
      padding: 15px;
      border-radius: 8px;
      font-size: 14px;
      color: #0ff;
      max-height: 300px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Hubstudio Remote Control</h1>

    <div class="input-group">
      <label>è¯·è¾“å…¥éš§é“åœ°å€:</label>
      <input type="text" id="tunnel-url" placeholder="ä¾‹å¦‚ï¼šhttps://xxxx.trycloudflare.com">
      <button onclick="listEnv()">è·å–ç¯å¢ƒåˆ—è¡¨</button>
      <button onclick="toggleJSON()">å±•å¼€/æ”¶èµ·åŸå§‹ JSON</button>
    </div>

    <div class="input-group">
      <label>é€‰æ‹©åˆ†ç»„:</label>
      <select id="groupFilter" onchange="applyFilter()">
        <option value="all">å…¨éƒ¨</option>
      </select>
    </div>

    <div class="table-container">
      <table id="envTable">
        <thead>
          <tr>
            <th><input type="checkbox" id="selectAll" onchange="toggleSelectAll(this)"></th>
            <th>ç¯å¢ƒID</th>
            <th>ç¯å¢ƒå</th>
            <th>åˆ†ç»„</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="actions">
      <button onclick="openSelected()">æ‰“å¼€é€‰ä¸­</button>
      <button onclick="closeSelected()">å…³é—­é€‰ä¸­</button>
      <button onclick="loginSelected()">ç™»å½•é€‰ä¸­</button>
    </div>

    <div class="pagination">
      <button onclick="prevPage()">ä¸Šä¸€é¡µ</button>
      <span id="pageInfo">ç¬¬ 1 / 1 é¡µ</span>
      <button onclick="nextPage()">ä¸‹ä¸€é¡µ</button>
    </div>

    <div id="jsonOutput" class="json-container"></div>
  </div>

  <script>
    let allData = [];
    let filteredData = [];
    let currentPage = 1;
    const pageSize = 10;

    async function listEnv() {
      const tunnel = document.getElementById("tunnel-url").value.trim();
      if (!tunnel) return alert("è¯·è¾“å…¥éš§é“åœ°å€");

      const proxyUrl = "https://api.aistreams.online/?url=" + encodeURIComponent(tunnel + "/api/v1/env/list");
      const res = await fetch(proxyUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ current: 1, size: 200 })
      });

      const json = await res.json();
      allData = json.data.list || [];
      filteredData = allData;

      renderTable();
      fillGroupFilter();
      document.getElementById("jsonOutput").innerText = JSON.stringify(json, null, 2);
    }

    function fillGroupFilter() {
      const select = document.getElementById("groupFilter");
      const groups = [...new Set(allData.map(e => e.tagName || "æœªåˆ†ç»„"))];
      select.innerHTML = `<option value="all">å…¨éƒ¨</option>` + groups.map(g => `<option value="${g}">${g}</option>`).join("");
    }

    function applyFilter() {
      const group = document.getElementById("groupFilter").value;
      filteredData = group === "all" ? allData : allData.filter(e => e.tagName === group);
      currentPage = 1;
      renderTable();
    }

    function renderTable() {
      const tbody = document.querySelector("#envTable tbody");
      tbody.innerHTML = "";
      const start = (currentPage - 1) * pageSize;
      const pageItems = filteredData.slice(start, start + pageSize);

      for (const env of pageItems) {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td><input type="checkbox" class="env-check" value="${env.containerCode}" checked></td>
          <td>${env.containerCode}</td>
          <td>${env.containerName}</td>
          <td>${env.tagName || "æœªåˆ†ç»„"}</td>
        `;
        tbody.appendChild(tr);
      }
      document.getElementById("pageInfo").innerText = `ç¬¬ ${currentPage} / ${Math.ceil(filteredData.length / pageSize) || 1} é¡µ`;
    }

    function toggleSelectAll(el) {
      document.querySelectorAll(".env-check").forEach(cb => cb.checked = el.checked);
    }

    function getSelected() {
      return Array.from(document.querySelectorAll(".env-check:checked")).map(cb => cb.value);
    }

    async function openSelected() {
      const tunnel = document.getElementById("tunnel-url").value.trim();
      const ids = getSelected();
      if (ids.length === 0) return alert("æœªé€‰æ‹©ç¯å¢ƒ");

      for (const id of ids) {
        const proxyUrl = "https://api.aistreams.online/?url=" + encodeURIComponent(tunnel + "/api/v1/browser/start");
        await fetch(proxyUrl, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ containerCode: id, isHeadless: false })
        });
      }
      alert("å·²å‘é€æ‰“å¼€è¯·æ±‚");
    }

    async function closeSelected() {
      const tunnel = document.getElementById("tunnel-url").value.trim();
      const ids = getSelected();
      if (ids.length === 0) return alert("æœªé€‰æ‹©ç¯å¢ƒ");

      for (const id of ids) {
        const proxyUrl = "https://api.aistreams.online/?url=" + encodeURIComponent(tunnel + "/api/v1/browser/stop");
        await fetch(proxyUrl, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ containerCode: id })
        });
      }
      alert("å·²å‘é€å…³é—­è¯·æ±‚");
    }

   async function loginSelected() {
    const tunnel = document.getElementById("tunnel-url").value.trim();
    const ids = getSelected();
    if (ids.length === 0) return alert("æœªé€‰æ‹©ç¯å¢ƒ");

    // ğŸ‘‰ ä»ç¯å¢ƒåˆ—è¡¨é‡Œå–è´¦å·ï¼ˆaccounts[0].accountNameï¼‰
    const selectedEnvs = allData.filter(e => ids.includes(e.containerCode.toString()));
    if (selectedEnvs.length === 0 || !selectedEnvs[0].accounts || selectedEnvs[0].accounts.length === 0) {
      return alert("âŒ é€‰ä¸­çš„ç¯å¢ƒæ²¡æœ‰è´¦å·ä¿¡æ¯");
    }
    const accountName = selectedEnvs[0].accounts[0].accountName;

    // ğŸ‘‰ ä½ ç»Ÿä¸€çš„å¯†ç ï¼ˆå¯ä»¥å†™æ­»ï¼Œæˆ–è€…ä»¥åæ”¾åˆ°å‰ç«¯è¾“å…¥æ¡†ï¼‰
    const password = "ä½ çš„ç»Ÿä¸€å¯†ç ";

    const res = await fetch("https://api.aistreams.online/autologin", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        tunnelUrl: tunnel,
        containerCodes: ids,
        accountName: accountName,
        password: password
      })
    });

    const json = await res.json();
    if (json.success) {
      alert("ğŸµ è‡ªåŠ¨ç™»å½•æˆåŠŸï¼");
    } else {
      alert("âŒ è‡ªåŠ¨ç™»å½•å¤±è´¥: " + (json.error || JSON.stringify(json)));
    }
  }


    function prevPage() {
      if (currentPage > 1) {
        currentPage--;
        renderTable();
      }
    }

    function nextPage() {
      if (currentPage < Math.ceil(filteredData.length / pageSize)) {
        currentPage++;
        renderTable();
      }
    }

    function toggleJSON() {
      const box = document.getElementById("jsonOutput");
      box.style.display = box.style.display === "none" ? "block" : "none";
    }
  </script>
</body>
</html>

